{% extends "base.html" %}
{% block content %}
<section class="panel">
  <h2>設定</h2>
  <p>CSV: <a href="/api/csv/export">エクスポート</a></p>
</section>

<section class="panel">
  <h3>支払い元</h3>
  <form method="post" action="/settings/accounts" class="row">
    <input type="hidden" name="year" value="{{ selected_year }}">
    <input name="name" placeholder="名称" required>
    <input name="kind" placeholder="kind (cash/bank/prepaid/other/card)" value="other">
    <input name="note" placeholder="備考">
    <button type="submit">追加</button>
  </form>

  <details>
    <summary>JSONインポート</summary>
    <p><a href="/static/templates/accounts_import_template.json" target="_blank">JSONテンプレート</a> / <a href="/static/templates/accounts_import_prompt_template.md" target="_blank">AI向け指示書テンプレート</a></p>
    <form method="post" action="/settings/accounts/import-json">
      <input type="hidden" name="year" value="{{ selected_year }}">
      <textarea name="payload" rows="10" style="width:100%;" placeholder='{"accounts":[{"name":"現金","kind":"cash","note":"財布"}]}' required></textarea>
      <button type="submit">JSONでインポート</button>
    </form>
  </details>

  <form method="post" action="/settings/accounts/delete">
    <input type="hidden" name="year" value="{{ selected_year }}">
    <table>
      <thead><tr><th>削除</th><th>名称</th><th>種別</th><th>備考</th></tr></thead>
      <tbody>
        {% for a in accounts %}
        <tr>
          <td><input type="checkbox" name="account_ids" value="{{ a.id }}"></td>
          <td>{{ a.name }}</td>
          <td>{{ a.kind }}</td>
          <td>{{ a.note or "" }}</td>
        </tr>
        {% else %}
        <tr><td colspan="4">未登録</td></tr>
        {% endfor %}
      </tbody>
    </table>
    <button type="submit">選択した支払い元を削除</button>
  </form>
</section>

<section class="panel">
  <h3>カテゴリ</h3>
  <form method="post" action="/settings/categories" class="row">
    <input type="hidden" name="year" value="{{ selected_year }}">
    <input name="name" placeholder="カテゴリ名" required>
    <button type="submit">追加</button>
  </form>

  <form method="post" action="/settings/categories/delete">
    <input type="hidden" name="year" value="{{ selected_year }}">
    <table>
      <thead><tr><th>削除</th><th>カテゴリ名</th></tr></thead>
      <tbody>
        {% for c in categories %}
        <tr>
          <td><input type="checkbox" name="category_ids" value="{{ c.id }}"></td>
          <td>{{ c.name }}</td>
        </tr>
        {% else %}
        <tr><td colspan="2">未登録</td></tr>
        {% endfor %}
      </tbody>
    </table>
    <button type="submit">選択したカテゴリを削除</button>
  </form>
</section>

<section class="panel">
  <h3>負債</h3>
  <form method="post" action="/settings/liabilities" class="row">
    <input type="hidden" name="year" value="{{ selected_year }}">
    <input name="name" placeholder="名称" required>
    <input type="number" name="balance" placeholder="残高" required>
    <input type="number" name="monthly_payment" placeholder="毎月返済額">
    <input type="number" name="payment_day" min="1" max="31" placeholder="返済日">
    <input name="note" placeholder="備考">
    <button type="submit">追加</button>
  </form>

  <form method="post" action="/settings/liabilities/delete">
    <input type="hidden" name="year" value="{{ selected_year }}">
    <table>
      <thead><tr><th>削除</th><th>名称</th><th>残高</th><th>毎月返済額</th><th>返済日</th><th>備考</th></tr></thead>
      <tbody>
        {% for l in liabilities %}
        <tr>
          <td><input type="checkbox" name="liability_ids" value="{{ l.id }}"></td>
          <td>{{ l.name }}</td>
          <td>{{ l.balance }}</td>
          <td>{{ l.monthly_payment or "" }}</td>
          <td>{{ l.payment_day or "" }}</td>
          <td>{{ l.note or "" }}</td>
        </tr>
        {% else %}
        <tr><td colspan="6">未登録</td></tr>
        {% endfor %}
      </tbody>
    </table>
    <button type="submit">選択した負債を削除</button>
  </form>
</section>
{% endblock %}
