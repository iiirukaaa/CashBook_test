{% extends "base.html" %}
{% block content %}
<section class="panel">
  <h2>設定</h2>
  <p>CSV: <a href="/api/csv/export">エクスポート</a></p>
</section>

<section class="panel">
  <h3>支払い元（Account）</h3>
  <form method="post" action="/settings/accounts" class="row">
    <input type="hidden" name="year" value="{{ selected_year }}">
    <input name="name" placeholder="名称" required>
    <input name="kind" placeholder="kind (cash/bank/prepaid/other/card)" value="other">
    <input name="note" placeholder="備考">
    <button type="submit">追加</button>
  </form>

  <details>
    <summary>JSONインポート</summary>
    <p><a href="/static/templates/accounts_import_template.json" target="_blank">JSONテンプレート</a> / <a href="/static/templates/accounts_import_prompt_template.md" target="_blank">AI向け指示書テンプレート</a></p>
    <form method="post" action="/settings/accounts/import-json">
      <input type="hidden" name="year" value="{{ selected_year }}">
      <textarea name="payload" rows="10" style="width:100%;" placeholder='{"accounts":[{"name":"現金","kind":"cash","note":"財布"}]}' required></textarea>
      <button type="submit">JSONでインポート</button>
    </form>
  </details>

  <form method="post" action="/settings/accounts/delete">
    <input type="hidden" name="year" value="{{ selected_year }}">
    <ul>
      {% for a in accounts %}
        <li>
          <label><input type="checkbox" name="account_ids" value="{{ a.id }}"> {{ a.name }} ({{ a.kind }})</label>
        </li>
      {% else %}
        <li>未登録</li>
      {% endfor %}
    </ul>
    <button type="submit">選択した支払い元を削除</button>
  </form>
</section>

<section class="panel">
  <h3>カテゴリ</h3>
  <form method="post" action="/settings/categories" class="row">
    <input type="hidden" name="year" value="{{ selected_year }}">
    <input name="name" placeholder="カテゴリ名" required>
    <label><input type="checkbox" name="is_fixed" value="true"> 固定カテゴリ</label>
    <button type="submit">追加</button>
  </form>

  <form method="post" action="/settings/categories/delete">
    <input type="hidden" name="year" value="{{ selected_year }}">
    <ul>
      {% for c in categories %}
        <li>
          <label><input type="checkbox" name="category_ids" value="{{ c.id }}"> {{ c.name }} {% if c.is_fixed %}(固定){% endif %}</label>
        </li>
      {% else %}
        <li>未登録</li>
      {% endfor %}
    </ul>
    <button type="submit">選択したカテゴリを削除</button>
  </form>
</section>

<section class="panel">
  <h3>負債</h3>
  <form method="post" action="/settings/liabilities" class="row">
    <input type="hidden" name="year" value="{{ selected_year }}">
    <input name="name" placeholder="名称" required>
    <input type="number" name="balance" placeholder="残高" required>
    <input type="number" name="monthly_payment" placeholder="毎月返済額">
    <input type="number" name="payment_day" min="1" max="31" placeholder="返済日">
    <input name="note" placeholder="備考">
    <button type="submit">追加</button>
  </form>

  <form method="post" action="/settings/liabilities/delete">
    <input type="hidden" name="year" value="{{ selected_year }}">
    <ul>
      {% for l in liabilities %}
        <li>
          <label><input type="checkbox" name="liability_ids" value="{{ l.id }}"> {{ l.name }}: {{ l.balance }} 円</label>
        </li>
      {% else %}
        <li>未登録</li>
      {% endfor %}
    </ul>
    <button type="submit">選択した負債を削除</button>
  </form>
</section>
{% endblock %}
